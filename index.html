<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Приложение для Схватки</title>
    <!-- Подключаем Tailwind CSS для стилей -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Устанавливаем шрифт Inter по умолчанию и черный фон для всего тела */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            color: #ffffff;
            height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        /* Анимация вращающегося лоадера */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            border-top-color: #f87171; /* Красный цвет для спиннера */
            animation: spin 1s linear infinite;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'custom-red': '#dc2626', /* Интенсивный красный для кнопки */
                        'custom-red-hover': '#b91c1c',
                    }
                }
            }
        }
    </script>
</head>
<body>

    <!-- 1. Экран Загрузки (Loading Screen) -->
    <div id="loading-screen" class="absolute inset-0 flex flex-col items-center justify-center transition-opacity duration-1000 bg-black z-20">
        <!-- Спиннер -->
        <div class="spinner w-12 h-12 border-4 border-gray-700 rounded-full"></div>
        <p class="mt-4 text-xl text-gray-400" id="loading-message">
            Проверяем кэш...
        </p>
        <p class="mt-2 text-sm text-gray-500">
            (Настоящая загрузка файлов симулируется задержкой)
        </p>
    </div>

    <!-- 2. Основной Экран (Main Screen) -->
    <div id="main-screen" class="hidden absolute inset-0 flex flex-col items-center justify-center transition-opacity duration-1000 bg-black z-10">
        <h1 class="text-4xl sm:text-6xl font-extrabold mb-8 text-gray-100">ПОЛЕ БИТВЫ</h1>
        <p class="text-xl text-gray-400 mb-12">
            Вы готовы к схватке?
        </p>
        <!-- Красная Кнопка -->
        <button id="start-button" class="px-12 py-4 text-xl font-bold rounded-xl shadow-lg transition duration-300 ease-in-out bg-custom-red hover:bg-custom-red-hover active:bg-red-700 transform hover:scale-105">
            НАЧАТЬ СХВАТКУ
        </button>
    </div>
    
    <!-- 3. Экран Видео (Video Screen) -->
    <div id="video-screen" class="hidden absolute inset-0 bg-black flex items-center justify-center z-10">
        <!-- Контейнер, заполняющий весь экран и содержащий видео -->
        <div class="relative w-full h-full">
            <!-- Видео на заднем плане, растянуто на весь экран -->
            <!-- object-cover обеспечивает полноэкранное отображение вертикального видео -->
            <!-- Атрибут "muted" удален, чтобы включить звук -->
            <video id="battle-video" class="w-full h-full object-cover absolute top-0 left-0" autoplay crossorigin="anonymous"></video>
            
            <!-- Индикатор загрузки видео (поверх) -->
            <div id="video-loading" class="absolute inset-0 bg-black bg-opacity-75 flex flex-col items-center justify-center hidden z-30">
                <div class="spinner w-16 h-16 border-8 border-gray-600 rounded-full"></div>
                <p class="mt-4 text-xl text-gray-300">Загрузка видео...</p>
            </div>
        </div>
    </div>


    <!-- Кастомное Модальное Сообщение (вместо alert) -->
    <div id="message-box" class="hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-xl shadow-2xl max-w-sm text-center">
            <p class="text-white text-lg mb-4" id="box-message"></p>
            <button onclick="document.getElementById('message-box').classList.add('hidden')" class="bg-custom-red text-white px-4 py-2 rounded-lg hover:bg-custom-red-hover">Закрыть</button>
        </div>
    </div>


    <script type="text/javascript">
        // Инициализация элементов
        const loadingScreen = document.getElementById('loading-screen');
        const mainScreen = document.getElementById('main-screen');
        const videoScreen = document.getElementById('video-screen');
        const battleVideo = document.getElementById('battle-video');
        // Элементы визуализатора удалены
        const loadingMessage = document.getElementById('loading-message');
        const startButton = document.getElementById('start-button');
        const messageBox = document.getElementById('message-box');
        const boxMessage = document.getElementById('box-message');
        const videoLoading = document.getElementById('video-loading'); 

        // Ключ для кэша в localStorage
        const CACHE_KEY = 'appCacheLoaded';
        
        // =================================================================
        // ВАШ СПИСОК ВИДЕО
        // =================================================================
        const VIDEO_LIST = [
            'https://files.catbox.moe/y09yxd.mp4', // Видео 1
            'https://files.catbox.moe/lpgf7b.mp4', // Видео 2
            'https://files.catbox.moe/9wgpqh.mp4', // Видео 3
            'https://files.catbox.moe/0es5aa.mp4', // Видео 4 (Добавлено)
        ];
        let currentVideoIndex = 0;
        
        // =================================================================
        // Функции визуализатора удалены
        // =================================================================

        /**
         * Отображает кастомное модальное сообщение (вместо alert()).
         * @param {string} message Сообщение для отображения.
         */
        function showMessage(message) {
            boxMessage.textContent = message;
            messageBox.classList.remove('hidden');
        }

        /**
         * Симулирует загрузку ресурсов (с кэшированием видео).
         */
        async function simulateLoad() {
            const isFirstLoad = localStorage.getItem(CACHE_KEY) === null;
            const startTime = performance.now();
            let messageText;
            const minLoadTime = 500; 

            if (isFirstLoad) {
                messageText = 'Кэш не найден. Первая загрузка будет долгой: загружаем все видео и ждем их полной загрузки...';
                loadingMessage.textContent = messageText;

                try {
                    // Асинхронно запускаем загрузку всех видео с принудительным кэшированием
                    const fetchPromises = VIDEO_LIST.map(url => 
                        fetch(url, { mode: 'cors', cache: 'force-cache' }) 
                    );
                    
                    // Ждем, пока ВСЕ промисы завершатся (т.е. все видео загрузятся)
                    await Promise.all(fetchPromises);
                    
                    const elapsed = performance.now() - startTime;
                    const remainingTime = Math.max(0, 3000 - elapsed); 

                    // Гарантируем минимальную задержку 3 секунды
                    await new Promise(resolve => setTimeout(resolve, remainingTime));
                    
                    localStorage.setItem(CACHE_KEY, 'true');
                    messageText = 'Видео успешно закэшированы! Теперь все будет быстро.';

                } catch (e) {
                    console.error("Ошибка при предварительной загрузке видео:", e);
                    messageText = 'Ошибка кэширования. Продолжаем, но загрузка может быть долгой.';
                    // Гарантируем минимальную задержку 3 секунды даже при ошибке
                    await new Promise(resolve => setTimeout(resolve, 3000)); 
                }

            } else {
                messageText = 'Кэш найден! Загрузка займет всего полсекунды.';
                loadingMessage.textContent = messageText;
                await new Promise(resolve => setTimeout(resolve, minLoadTime));
            }

            loadingMessage.textContent = messageText; 
            loadingScreen.style.opacity = '0';
            
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                mainScreen.classList.remove('hidden');
                mainScreen.style.opacity = '1'; 
            }, 1000);
        }
        
        /**
         * Воспроизводит видео по заданному индексу.
         */
        function playVideo(index) {
            if (index >= VIDEO_LIST.length) {
                showMessage("Схватка окончена! Все видео были показаны.");
                currentVideoIndex = 0; 
                
                videoScreen.classList.add('hidden');
                mainScreen.classList.remove('hidden');
                return;
            }

            currentVideoIndex = index;
            battleVideo.src = VIDEO_LIST[currentVideoIndex];
            videoLoading.classList.remove('hidden'); 
            
            battleVideo.load();
            
            // Если звук не включится автоматически, пользователю, возможно, потребуется нажать на экран/видео.
            battleVideo.play().then(() => {
                videoLoading.classList.add('hidden'); 
            }).catch(e => {
                videoLoading.classList.add('hidden'); 
                console.error(`Ошибка при воспроизведении видео №${index + 1} (${VIDEO_LIST[currentVideoIndex]}):`, e);
                showMessage(`Ошибка воспроизведения видео №${index + 1}.`);
                playVideo(currentVideoIndex + 1);
            });
        }
        
        /**
         * Запускает последовательное воспроизведение видео.
         */
        function startBattle() {
            mainScreen.classList.add('hidden');
            videoScreen.classList.remove('hidden');
            
            currentVideoIndex = 0; 
            playVideo(currentVideoIndex);
        }


        // =================================================================
        // СЛУШАТЕЛИ СОБЫТИЙ
        // =================================================================

        // Запуск симуляции загрузки при старте
        window.onload = () => {
            simulateLoad();
        };

        // Обработчик кнопки "Начать схватку"
        startButton.addEventListener('click', startBattle);
        
        // Обработчик для автоматического переключения видео, когда текущее заканчивается
        battleVideo.addEventListener('ended', () => {
            playVideo(currentVideoIndex + 1);
        });
        
    </script>

</body>
</html>